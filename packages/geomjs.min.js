(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=[].slice,d={}.hasOwnProperty,v=function(e,t){function r(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};this.geomjs||(this.geomjs={}),Math.degToRad=function(e){return e*Math.PI/180},Math.radToDeg=function(e){return e*180/Math.PI},Math.normalize=function(e,t,n){return(e-t)/(n-t)},Math.interpolate=function(e,t,n){return t+(n-t)*e},Math.deltaBelowRatio=function(e,t,n){return n==null&&(n=1e10),Math.abs(e-t)<1/n},Math.map=function(e,t,n,r,i){return Math.interpolate(Math.normalize(e,t,n),r,i)},u=function(){function e(){}return e.attachTo=function(e){var t,n,r,i;r=this.prototype,i=[];for(t in r)n=r[t],i.push(e.prototype[t]=n);return i},e}(),n=function(){var e;return e=1<=arguments.length?p.call(arguments,0):[],function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return v(n,t),n.prototype.equals=function(t){var n=this;return t!=null&&e.every(function(e){return n[e].equals!=null?n[e].equals(t[e]):t[e]===n[e]})},n}(u)},r=function(){var e,t;return e=arguments[0],t=2<=arguments.length?p.call(arguments,1):[],function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return v(r,n),r.prototype.toString=function(){var n,r;return n=function(){var e,n,i;i=[];for(e=0,n=t.length;e<n;e++)r=t[e],i.push(""+r+"="+this[r]);return i}.call(this),"["+e+"("+n.join(", ")+")]"},r.prototype.classname=function(){return e},r}(u)},i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var t;return v(n,e),n.prototype.points=function(){},n.prototype.closedGeometry=function(){return!1},t=function(e,t,n,r){return e.reduce(function(e,r){return Math[t](e,r[n])},r)},n.prototype.top=function(){return t(this.points(),"min","y",Infinity)},n.prototype.bottom=function(){return t(this.points(),"max","y",-Infinity)},n.prototype.left=function(){return t(this.points(),"min","x",Infinity)},n.prototype.right=function(){return t(this.points(),"max","x",-Infinity)},n.prototype.bounds=function(){return{top:this.top(),left:this.left(),right:this.right(),bottom:this.bottom()}},n.prototype.boundingBox=function(){return new l(this.left(),this.top(),this.right()-this.left(),this.bottom()-this.top())},n.prototype.stroke=function(e,t){t==null&&(t="#ff0000");if(e==null)return;return e.strokeStyle=t,this.drawPath(e),e.stroke()},n.prototype.fill=function(e,t){t==null&&(t="#ff0000");if(e==null)return;return e.fillStyle=t,this.drawPath(e),e.fill()},n.prototype.drawPath=function(e){},n}(u),c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.acreage=function(){return null},t.prototype.randomPointInSurface=function(){return null},t.prototype.contains=function(e,t){return null},t.prototype.containsGeometry=function(e){var t=this;return e.points().every(function(e){return t.contains(e)})},t}(u),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.length=function(){return null},t.prototype.pathPointAt=function(e,t){return t==null&&(t=!0),null},t.prototype.pathOrientationAt=function(e,t){var n,r,i;return t==null&&(t=!0),r=this.pathPointAt(e-.01),i=this.pathPointAt(e+.01),n=i.subtract(r),n.angle()},t.prototype.pathTangentAt=function(e,t,n){return t==null&&(t=.01),n==null&&(n=!0),this.pathPointAt((e+t)%1).subtract(this.pathPointAt((1+e-t)%1)).normalize(1)},t}(u),s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return v(t,e),t.iterators={},t.prototype.intersects=function(e){var t,n;return e.bounds!=null&&!this.boundsCollide(e)?!1:(n=!1,t=this.intersectionsIterator(this,e),t.call(this,this,e,function(){return n=!0}),n)},t.prototype.intersections=function(e){var t,n;return e.bounds!=null&&!this.boundsCollide(e)?null:(n=[],t=this.intersectionsIterator(this,e),t.call(this,this,e,function(e){return n.push(e),!1}),n.length>0?n:null)},t.prototype.boundsCollide=function(e){var t,n;return t=this.bounds(),n=e.bounds(),!(t.top>n.bottom||t.left>n.right||t.bottom<n.top||t.right<n.left)},t.prototype.intersectionsIterator=function(e,n){var r,i,s;return r=e.classname?e.classname():"",i=n.classname?n.classname():"",s=null,s=t.iterators[r+i],s||(s=t.iterators[r]),s||(s=t.iterators[i]),s||this.eachIntersections},t.prototype.eachIntersections=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;r==null&&(r=!1),b=e.points(),w=t.points(),m=b.length,g=w.length,y=[];for(d=x=0,N=m-2;0<=N?x<=N:x>=N;d=0<=N?++x:--x){E=b[d],h=b[d+1],l=h.subtract(E);for(v=T=0,C=g-2;0<=C?T<=C:T>=C;v=0<=C?++T:--T){S=w[v],p=w[v+1],c=p.subtract(S),s=this.perCrossing(E,l,S,c),o=s.subtract(h),u=s.subtract(E),a=s.subtract(p),f=s.subtract(S);if(o.length()<=l.length()&&u.length()<=l.length()&&a.length()<=c.length()&&f.length()<=c.length()){r&&(i={segment1:l,segmentIndex1:d,segmentStart1:E,segmentEnd1:h,segment2:c,segmentIndex2:v,segmentStart2:S,segmentEnd2:p});if(n.call(this,s,i))return}}}},t.prototype.perCrossing=function(e,t,n,r){var i,s,o,u,a,l,c;return l=n.x-e.x,c=n.y-e.y,o=l*r.y-c*r.x,u=t.x*r.y-t.y*r.x,a=o/u,i=e.x+t.x*a,s=e.y+t.y*a,new f(i,s)},t}(u),f=function(){function e(e,t){var n,r,i;r=this.coordsFrom(e,t),n=r[0],t=r[1],i=this.defaultToZero(n,t),this.x=i[0],this.y=i[1]}return n("x","y").attachTo(e),r("Point","x","y").attachTo(e),e.isPoint=function(e){return e!=null&&e.x!=null&&e.y!=null},e.isFloat=function(e){return!isNaN(parseFloat(e))},e.coordsFrom=function(e,t,n){var r;return n==null&&(n=!1),r=e,e!=null&&typeof e=="object"&&(r=e.x,t=e.y),r=parseFloat(r),t=parseFloat(t),n&&(isNaN(r)||isNaN(t))&&this.notAPoint([r,t]),[r,t]},e.polar=function(t,n){return n==null&&(n=1),new e(Math.sin(t)*n,Math.cos(t)*n)},e.interpolate=function(t,n,r){var i,s,o,u,a,f,l,c=this;i=[];for(u=f=0,l=arguments.length;f<l;u=++f)a=arguments[u],i[u]=a;return o=function(t,n){var r;return r=null,c.isPoint(t[0])?r=t.shift():c.isFloat(t[0])&&c.isFloat(t[1])?(r=new e(t[0],t[1]),t.splice(0,2)):c.missingPoint(t,n),r},t=o(i,"first"),n=o(i,"second"),r=parseFloat(i.shift()),isNaN(r)&&this.missingPosition(r),s=n.subtract(t),new e(t.x+s.x*r,t.y+s.y*r)},e.missingPosition=function(e){throw new Error("Point.interpolate require a position but "+e+" was given")},e.missingPoint=function(e,t){throw new Error("Can't find the "+t+" point in Point.interpolate arguments "+e)},e.notAPoint=function(e){throw new Error(""+e+" isn't a point-like object")},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.angle=function(){return Math.radToDeg(Math.atan2(this.y,this.x))},e.prototype.angleWith=function(t,n){var r,i,s;return t==null&&n==null&&this.noPoint("dot"),s=this.coordsFrom(t,n,!0),i=s[0],n=s[1],r=this.normalize().dot((new e(i,n)).normalize()),Math.radToDeg(Math.acos(Math.abs(r))*(r<0?-1:1))},e.prototype.normalize=function(t){var n;return t==null&&(t=1),this.isFloat(t)||this.invalidLength(t),n=this.length(),new e(this.x/n*t,this.y/n*t)},e.prototype.add=function(t,n){var r,i,s;return i=this.coordsFrom(t,n),r=i[0],n=i[1],s=this.defaultToZero(r,n),r=s[0],n=s[1],new e(this.x+r,this.y+n)},e.prototype.subtract=function(t,n){var r,i,s;return i=this.coordsFrom(t,n),r=i[0],n=i[1],s=this.defaultToZero(r,n),r=s[0],n=s[1],new e(this.x-r,this.y-n)},e.prototype.dot=function(e,t){var n,r;return e==null&&t==null&&this.noPoint("dot"),r=this.coordsFrom(e,t,!0),n=r[0],t=r[1],this.x*n+this.y*t},e.prototype.distance=function(e,t){var n,r;return e==null&&t==null&&this.noPoint("dot"),r=this.coordsFrom(e,t,!0),n=r[0],t=r[1],this.subtract(n,t).length()},e.prototype.scale=function(t){return this.isFloat(t)||this.invalidScale(t),new e(this.x*t,this.y*t)},e.prototype.rotate=function(t){var n,r,i,s;return this.isFloat(t)||this.invalidRotation(t),r=this.length(),n=Math.atan2(this.y,this.x)+Math.degToRad(t),i=Math.cos(n)*r,s=Math.sin(n)*r,new e(i,s)},e.prototype.rotateAround=function(e,t,n){var r,i;return this.isPoint(e)&&(n=t),i=this.coordsFrom(e,t,!0),r=i[0],t=i[1],this.subtract(r,t).rotate(n).add(r,t)},e.prototype.isPoint=function(t){return e.isPoint(t)},e.prototype.isFloat=function(t){return e.isFloat(t)},e.prototype.coordsFrom=function(t,n,r){return e.coordsFrom(t,n,r)},e.prototype.defaultToZero=function(e,t){return e=isNaN(e)?0:e,t=isNaN(t)?0:t,[e,t]},e.prototype.paste=function(e,t){var n,r;return r=this.coordsFrom(e,t),n=r[0],t=r[1],isNaN(n)||(this.x=n),isNaN(t)||(this.y=t),this},e.prototype.clone=function(){return new e(this)},e.prototype.noPoint=function(e){throw new Error(""+e+" was called without arguments")},e.prototype.invalidLength=function(e){throw new Error("Invalid length "+e+" provided")},e.prototype.invalidScale=function(e){throw new Error("Invalid scale "+e+" provided")},e.prototype.invalidRotation=function(e){throw new Error("Invalid rotation "+e+" provided")},e}(),o=function(){function t(e,t,n,r,i,s){var o;e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s),this.a=o[0],this.b=o[1],this.c=o[2],this.d=o[3],this.tx=o[4],this.ty=o[5]}var e;return e=["a","b","c","d","tx","ty"],n.apply(null,e).attachTo(t),r.apply(null,["Matrix"].concat(e)).attachTo(t),t.isMatrix=function(t){var n,r,i;if(t==null)return!1;for(r=0,i=e.length;r<i;r++){n=e[r];if(!this.isFloat(t[n]))return!1}return!0},t.isFloat=function(){var e,t,n,r;t=1<=arguments.length?p.call(arguments,0):[];for(n=0,r=t.length;n<r;n++){e=t[n];if(isNaN(parseFloat(e)))return!1}return!0},t.prototype.transformPoint=function(e,t){var n,r,i,s;if(e==null&&t==null)throw new Error("transformPoint was called without arguments");return s=f.coordsFrom(e,t,!0),n=s[0],t=s[1],r=n*this.a+t*this.c+this.tx,i=n*this.b+t*this.d+this.ty,new f(r,i)},t.prototype.translate=function(e,t){var n,r;return r=this.coordsFrom(e,t,0),n=r[0],t=r[1],this.tx+=n,this.ty+=t,this},t.prototype.scale=function(e,t){var n,r;return r=this.coordsFrom(e,t,1),n=r[0],t=r[1],this.a*=n,this.d*=t,this.tx*=n,this.ty*=t,this},t.prototype.rotate=function(e){var t,n,r;return e==null&&(e=0),t=Math.cos(Math.degToRad(e)),n=Math.sin(Math.degToRad(e)),r=[this.a*t-this.b*n,this.a*n+this.b*t,this.c*t-this.d*n,this.c*n+this.d*t,this.tx*t-this.ty*n,this.tx*n+this.ty*t],this.a=r[0],this.b=r[1],this.c=r[2],this.d=r[3],this.tx=r[4],this.ty=r[5],this},t.prototype.skew=function(e,t){var n,r,i;return r=this.coordsFrom(e,t,0),n=r[0],t=r[1],i=[Math.degToRad(n),Math.degToRad(t)],n=i[0],t=i[1],this.append(Math.cos(t),Math.sin(t),-Math.sin(n),Math.cos(n))},t.prototype.append=function(e,t,n,r,i,s){var o,u;return e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s),e=o[0],t=o[1],n=o[2],r=o[3],i=o[4],s=o[5],u=[e*this.a+t*this.c,e*this.b+t*this.d,n*this.a+r*this.c,n*this.b+r*this.d,i*this.a+s*this.c+this.tx,i*this.b+s*this.d+this.ty],this.a=u[0],this.b=u[1],this.c=u[2],this.d=u[3],this.tx=u[4],this.ty=u[5],this},t.prototype.prepend=function(e,t,n,r,i,s){var o,u,a;e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s),e=o[0],t=o[1],n=o[2],r=o[3],i=o[4],s=o[5];if(e!==1||t!==0||n!==0||r!==1)u=[this.a*e+this.b*n,this.a*t+this.b*r,this.c*e+this.d*n,this.c*t+this.d*r],this.a=u[0],this.b=u[1],this.c=u[2],this.d=u[3];return a=[this.tx*e+this.ty*n+i,this.tx*t+this.ty*r+s],this.tx=a[0],this.ty=a[1],this},t.prototype.identity=function(){var e;return e=[1,0,0,1,0,0],this.a=e[0],this.b=e[1],this.c=e[2],this.d=e[3],this.tx=e[4],this.ty=e[5],this},t.prototype.inverse=function(){var e,t;return e=this.a*this.d-this.b*this.c,t=[this.d/e,-this.b/e,-this.c/e,this.a/e,(this.c*this.ty-this.d*this.tx)/e,-(this.a*this.ty-this.b*this.tx)/e],this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.tx=t[4],this.ty=t[5],this},t.prototype.asFloat=function(){var e,t,n,r,i;e=1<=arguments.length?p.call(arguments,0):[];for(t=r=0,i=e.length;r<i;t=++r)n=e[t],e[t]=parseFloat(n);return e},t.prototype.matrixFrom=function(e,t,n,r,i,s){var o;return this.isMatrix(e)?(o=e,e=o.a,t=o.b,n=o.c,r=o.d,i=o.tx,s=o.ty):this.isFloat(e,t,n,r,i,s)||this.invalidMatrixArguments([e,t,n,r,i,s]),this.asFloat(e,t,n,r,i,s)},t.prototype.coordsFrom=function(e,t,n){var r,i;return i=f.coordsFrom(e,t),r=i[0],t=i[1],isNaN(r)&&(r=n),isNaN(t)&&(t=n),[r,t]},t.prototype.isMatrix=function(e){return t.isMatrix(e)},t.prototype.isFloat=function(){var e;return e=1<=arguments.length?p.call(arguments,0):[],t.isFloat.apply(t,e)},t.prototype.clone=function(){return new t(this)},t.prototype.invalidMatrixArguments=function(e){throw new Error("Invalid arguments "+e+" for a Matrix")},t}(),l=function(){function o(e,t,n,r,i){var s;s=this.defaultToZero.apply(this,this.rectangleFrom.apply(this,arguments)),this.x=s[0],this.y=s[1],this.width=s[2],this.height=s[3],this.rotation=s[4]}var e,t;return e=["x","y","width","height","rotation"],n.apply(null,e).attachTo(o),r.apply(null,["Rectangle"].concat(e)).attachTo(o),i.attachTo(o),c.attachTo(o),a.attachTo(o),s.attachTo(o),o.eachRectangleRectangleIntersections=function(e,t,n,r){var i,s,o,u;r==null&&(r=!1);if(!e.equals(t))return this.eachIntersections(e,t,n,r);u=e.points();for(s=0,o=u.length;s<o;s++){i=u[s];if(n.call(this,i))return}},t=s.iterators,t.RectangleRectangle=o.eachRectangleRectangleIntersections,o.prototype.topLeft=function(){return new f(this.x,this.y)},o.prototype.topRight=function(){return this.topLeft().add(this.topEdge())},o.prototype.bottomLeft=function(){return this.topLeft().add(this.leftEdge())},o.prototype.bottomRight=function(){return this.topLeft().add(this.topEdge()).add(this.leftEdge())},o.prototype.center=function(){return this.topLeft().add(this.topEdge().scale(.5)).add(this.leftEdge().scale(.5))},o.prototype.topEdgeCenter=function(){return this.topLeft().add(this.topEdge().scale(.5))},o.prototype.bottomEdgeCenter=function(){return this.bottomLeft().add(this.topEdge().scale(.5))},o.prototype.leftEdgeCenter=function(){return this.topLeft().add(this.leftEdge().scale(.5))},o.prototype.rightEdgeCenter=function(){return this.topRight().add(this.leftEdge().scale(.5))},o.prototype.topEdge=function(){return new f(this.width*Math.cos(Math.degToRad(this.rotation)),this.width*Math.sin(Math.degToRad(this.rotation)))},o.prototype.leftEdge=function(){return new f(this.height*Math.cos(Math.degToRad(this.rotation)+Math.PI/2),this.height*Math.sin(Math.degToRad(this.rotation)+Math.PI/2))},o.prototype.bottomEdge=function(){return this.topEdge()},o.prototype.rightEdge=function(){return this.leftEdge()},o.prototype.top=function(){return Math.min(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},o.prototype.bottom=function(){return Math.max(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},o.prototype.left=function(){return Math.min(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},o.prototype.right=function(){return Math.max(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},o.prototype.setCenter=function(e,t){var n,r,i;return i=f.coordsFrom(e,t),r=i[0],t=i[1],n=this.center(),this.x+=r-n.x,this.y+=t-n.y,this},o.prototype.rotateAroundCenter=function(e){var t;return t=this.topLeft().rotateAround(this.center(),e),this.x=t.x,this.y=t.y,this.rotation+=e,this},o.prototype.scaleAroundCenter=function(e){var t,n,r;return n=this.topLeft(),t=n.subtract(this.center()).scale(e),r=n.add(t.scale(.5)),this.x=r.x,this.y=r.y,this.width*=e,this.height*=e,this},o.prototype.inflateAroundCenter=function(e,t){var n;return n=this.center(),this.inflate(e,t),this.setCenter(n),this},o.prototype.inflate=function(e,t){var n,r;return r=f.coordsFrom(e,t),n=r[0],t=r[1],this.width+=n,this.height+=t,this},o.prototype.inflateLeft=function(e){var t,n;return this.width+=e,t=this.topEdge().normalize(-e),n=this.topLeft().add(t),this.x=n.x,this.y=n.y,this},o.prototype.inflateRight=function(e){return this.width+=e,this},o.prototype.inflateTop=function(e){var t,n;return this.height+=e,t=this.leftEdge().normalize(-e),n=this.topLeft().add(t),this.x=n.x,this.y=n.y,this},o.prototype.inflateBottom=function(e){return this.height+=e,this},o.prototype.inflateTopLeft=function(e,t){var n,r;return r=f.coordsFrom(e,t),n=r[0],t=r[1],this.inflateLeft(n),this.inflateTop(t),this},o.prototype.inflateTopRight=function(e,t){var n,r;return r=f.coordsFrom(e,t),n=r[0],t=r[1],this.inflateRight(n),this.inflateTop(t),this},o.prototype.inflateBottomLeft=function(e,t){var n,r;return r=f.coordsFrom(e,t),n=r[0],t=r[1],this.inflateLeft(n),this.inflateBottom(t),this},o.prototype.inflateBottomRight=function(e,t){return this.inflate(e,t)},o.prototype.closedGeometry=function(){return!0},o.prototype.points=function(){return[this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft(),this.topLeft()]},o.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(Math.degToRad(e))*1e4,Math.sin(Math.degToRad(e))*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},o.prototype.acreage=function(){return this.width*this.height},o.prototype.contains=function(e,t){var n,r,i;return r=f.coordsFrom(e,t),n=r[0],t=r[1],i=(new f(n,t)).rotateAround(this.topLeft(),-this.rotation),n=i.x,t=i.y,this.x<=n&&n<=this.x+this.width&&this.y<=t&&t<=this.y+this.height},o.prototype.randomPointInSurface=function(e){return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),this.topLeft().add(this.topEdge().scale(e.get())).add(this.leftEdge().scale(e.get()))},o.prototype.length=function(){return this.width*2+this.height*2},o.prototype.pathPointAt=function(e,t){var n,r,i,s;return t==null&&(t=!0),s=this.pathSteps(t),n=s[0],r=s[1],i=s[2],e<n?this.topLeft().add(this.topEdge().scale(Math.map(e,0,n,0,1))):e<r?this.topRight().add(this.rightEdge().scale(Math.map(e,n,r,0,1))):e<i?this.bottomRight().add(this.bottomEdge().scale(Math.map(e,r,i,0,1)*-1)):this.bottomLeft().add(this.leftEdge().scale(Math.map(e,i,1,0,1)*-1))},o.prototype.pathOrientationAt=function(e,t){var n,r,i,s,o;return t==null&&(t=!0),o=this.pathSteps(t),r=o[0],i=o[1],s=o[2],e<r?n=this.topEdge():e<i?n=this.rightEdge():e<s?n=this.bottomEdge().scale(-1):n=this.leftEdge().scale(-1),n.angle()},o.prototype.pathSteps=function(e){var t,n,r,i;return e==null&&(e=!0),e?(t=this.length(),n=this.width/t,r=(this.width+this.height)/t,i=n+r):(n=.25,r=.5,i=.75),[n,r,i]},o.prototype.drawPath=function(e){return e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.topRight().x,this.topRight().y),e.lineTo(this.bottomRight().x,this.bottomRight().y),e.lineTo(this.bottomLeft().x,this.bottomLeft().y),e.lineTo(this.x,this.y),e.closePath()},o.prototype.clone=function(){return new o(this)},o.prototype.paste=function(t,n,r,i,s){var o,u=this;return o=this.rectangleFrom(t,n,r,i,s),e.forEach(function(e,t){if(f.isFloat(o[t]))return u[e]=parseFloat(o[t])})},o.prototype.rectangleFrom=function(e,t,n,r,i){var s;return s=e,typeof e=="object"&&(s=e.x,t=e.y,n=e.width,r=e.height,i=e.rotation),[s,t,n,r,i]},o.prototype.defaultToZero=function(){var e,t,n,r,i;n=1<=arguments.length?p.call(arguments,0):[];for(e=r=0,i=n.length;r<i;e=++r)t=n[e],f.isFloat(t)||(n[e]=0);return n},o}(),h=function(){function e(e,t,n){f.isPoint(e)||this.invalidPoint("a",e),f.isPoint(t)||this.invalidPoint("b",t),f.isPoint(n)||this.invalidPoint("c",n),this.a=new f(e),this.b=new f(t),this.c=new f(n)}return n("a","b","c").attachTo(e),r("Triangle","a","b","c").attachTo(e),i.attachTo(e),c.attachTo(e),a.attachTo(e),s.attachTo(e),e.prototype.center=function(){return new f((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)},["abCenter","acCenter","bcCenter"].forEach(function(t){var n,r,i;return i=t.split(""),n=i[0],r=i[1],e.prototype[t]=function(){return this[n].add(this[""+n+r]().scale(.5))}}),["ab","ac","ba","bc","ca","cb"].forEach(function(t){var n,r,i;return i=t.split(""),n=i[0],r=i[1],e.prototype[t]=function(){return this[r].subtract(this[n])}}),["abc","bac","acb"].forEach(function(t){var n,r,i,s;return s=t.split(""),n=s[0],r=s[1],i=s[2],e.prototype[t]=function(){return this[""+r+n]().angleWith(this[""+r+i]())}}),e.prototype.top=function(){return Math.min(this.a.y,this.b.y,this.c.y)},e.prototype.bottom=function(){return Math.max(this.a.y,this.b.y,this.c.y)},e.prototype.left=function(){return Math.min(this.a.x,this.b.x,this.c.x)},e.prototype.right=function(){return Math.max(this.a.x,this.b.x,this.c.x)},e.prototype.equilateral=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())&&Math.deltaBelowRatio(this.ab().length(),this.ac().length())},e.prototype.isosceles=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())||Math.deltaBelowRatio(this.ab().length(),this.ac().length())||Math.deltaBelowRatio(this.bc().length(),this.ac().length())},e.prototype.rectangle=function(){var e;return e=90,Math.deltaBelowRatio(Math.abs(this.abc()),e)||Math.deltaBelowRatio(Math.abs(this.bac()),e)||Math.deltaBelowRatio(Math.abs(this.acb()),e)},e.prototype.rotateAroundCenter=function(e){var t;return t=this.center(),this.a=this.a.rotateAround(t,e),this.b=this.b.rotateAround(t,e),this.c=this.c.rotateAround(t,e),this},e.prototype.scaleAroundCenter=function(e){var t;return t=this.center(),this.a=t.add(this.a.subtract(t).scale(e)),this.b=t.add(this.b.subtract(t).scale(e)),this.c=t.add(this.c.subtract(t).scale(e)),this},e.prototype.closedGeometry=function(){return!0},e.prototype.points=function(){return[this.a.clone(),this.b.clone(),this.c.clone(),this.a.clone()]},e.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(Math.degToRad(e))*1e4,Math.sin(Math.degToRad(e))*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},e.prototype.acreage=function(){return this.ab().length()*this.bc().length()*Math.abs(Math.sin(this.abc()))/2},e.prototype.contains=function(e,t){var n,r,i,s,o,u,a,l,c,h,p,d,v,m;return m=f.coordsFrom(e,t),v=m[0],t=m[1],a=new f(v,t),h=this.ac(),p=this.ab(),d=a.subtract(this.a),n=h.dot(h),r=h.dot(p),i=h.dot(d),s=p.dot(p),o=p.dot(d),u=1/(n*s-r*r),l=(s*i-r*o)*u,c=(n*o-r*i)*u,c>0&&c>0&&l+c<1},e.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),t=e.get(),n=e.get(),r=this.a.add(this.ab().scale(t)).add(this.ca().scale(n*-1)),this.contains(r)?r:r.add(this.bcCenter().subtract(r).scale(2))},e.prototype.length=function(){return this.ab().length()+this.bc().length()+this.ca().length()},e.prototype.pathPointAt=function(e,t){var n,r,i;return t==null&&(t=!0),i=this.pathSteps(t),n=i[0],r=i[1],e<n?this.a.add(this.ab().scale(Math.map(e,0,n,0,1))):e<r?this.b.add(this.bc().scale(Math.map(e,n,r,0,1))):this.c.add(this.ca().scale(Math.map(e,r,1,0,1)))},e.prototype.pathOrientationAt=function(e,t){var n,r,i;return t==null&&(t=!0),i=this.pathSteps(t),n=i[0],r=i[1],e<n?this.ab().angle():e<r?this.bc().angle():this.ca().angle()},e.prototype.pathSteps=function(e){var t,n,r;return e?(t=this.length(),n=this.ab().length()/t,r=n+this.bc().length()/t):(n=1/3,r=2/3),[n,r]},e.prototype.drawPath=function(e){return e.beginPath(),e.moveTo(this.a.x,this.a.y),e.lineTo(this.b.x,this.b.y),e.lineTo(this.c.x,this.c.y),e.lineTo(this.a.x,this.a.y),e.closePath()},e.prototype.clone=function(){return new e(this.a,this.b,this.c)},e.prototype.invalidPoint=function(e,t){throw new Error("Invalid point "+t+" for vertex "+e)},e}(),e=function(){function t(e,t,n,r){var i;i=this.circleFrom(e,t,n,r),this.radius=i[0],this.x=i[1],this.y=i[2],this.segments=i[3]}var e;return n("x","y","radius").attachTo(t),r("Circle","x","y","radius").attachTo(t),i.attachTo(t),c.attachTo(t),a.attachTo(t),s.attachTo(t),t.eachIntersections=function(e,t,n,r){var i,s,o,u,a,f,l,c,h;r==null&&(r=!1),(typeof t.classname=="function"?t.classname():void 0)==="Circle"&&(c=[t,e],e=c[0],t=c[1]),a=t.points(),o=a.length,u=[];for(s=l=0,h=o-2;0<=h?l<=h:l>=h;s=0<=h?++l:--l){f=a[s],i=a[s+1];if(e.eachLineIntersections(f,i,n))return}},t.eachCircleCircleIntersections=function(e,t,n,r){var i,s,o,u,a,l,c,h,p,d,v,m,g,y;r==null&&(r=!1);if(!e.equals(t)){p=e.radius,d=t.radius,c=e.center(),h=t.center(),s=c.distance(h),o=h.subtract(c),v=p+d;if(s>v)return;return s===v?n.call(this,c.add(o.normalize(p))):(i=(p*p-d*d+s*s)/(2*s),u=Math.sqrt(p*p-i*i),a=new f(u*(h.y-c.y)/s,-u*(h.x-c.x)/s),l=c.add(o.normalize(i)).add(a),n.call(this,l),l=c.add(o.normalize(i)).add(a.scale(-1)),n.call(this,l))}y=e.points();for(m=0,g=y.length;m<g;m++){l=y[m];if(n.call(this,l))return}},e=s.iterators,e.Circle=t.eachIntersections,e.CircleCircle=t.eachCircleCircleIntersections,t.prototype.center=function(){return new f(this.x,this.y)},t.prototype.top=function(){return this.y-this.radius},t.prototype.bottom=function(){return this.y+this.radius},t.prototype.left=function(){return this.x-this.radius},t.prototype.right=function(){return this.x+this.radius},t.prototype.points=function(){var e,t,n,r,i;t=360/this.segments,i=[];for(e=n=0,r=this.segments;0<=r?n<=r:n>=r;e=0<=r?++n:--n)i.push(this.pointAtAngle(e*t));return i},t.prototype.closedGeometry=function(){return!0},t.prototype.eachLineIntersections=function(e,t,n){var r,i,s,o,u,a,l,c;r=this.center(),l=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),c=2*((t.x-e.x)*(e.x-r.x)+(t.y-e.y)*(e.y-r.y)),i=r.x*r.x+r.y*r.y+e.x*e.x+e.y*e.y-2*(r.x*e.x+r.y*e.y)-this.radius*this.radius,s=c*c-4*l*i;if(s>0){o=Math.sqrt(s),u=(-c+o)/(2*l),a=(-c-o)/(2*l);if(!(u<0||u>1)||!(a<0||a>1)){if(0<=a&&a<=1&&n.call(this,f.interpolate(e,t,a)))return;0<=u&&u<=1&&n.call(this,f.interpolate(e,t,u))}}},t.prototype.pointAtAngle=function(e){return new f(this.x+Math.cos(Math.degToRad(e))*this.radius,this.y+Math.sin(Math.degToRad(e))*this.radius)},t.prototype.acreage=function(){return this.radius*this.radius*Math.PI},t.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),r=this.pointAtAngle(e.random(360)),t=this.center(),n=r.subtract(t),t.add(n.scale(Math.sqrt(e.random())))},t.prototype.contains=function(e,t){var n,r;return r=f.coordsFrom(e,t,!0),n=r[0],t=r[1],this.center().subtract(n,t).length()<=this.radius},t.prototype.length=function(){return this.radius*Math.PI*2},t.prototype.pathPointAt=function(e){return this.pointAtAngle(e*360)},t.prototype.drawPath=function(e){return e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2)},t.prototype.clone=function(){return new t(this)},t.prototype.circleFrom=function(e,t,n,r){var i;return i=e,typeof e=="object"&&(i=e.radius,t=e.x,n=e.y,r=e.segments),f.isFloat(i)||(i=1),f.isFloat(t)||(t=0),f.isFloat(n)||(n=0),f.isFloat(r)||(r=36),[i,t,n,r]},t}(),t=function(){function e(e,t,n,r,i,s){var o;o=this.ellipsisFrom(e,t,n,r,i,s),this.radius1=o[0],this.radius2=o[1],this.x=o[2],this.y=o[3],this.rotation=o[4],this.segments=o[5]}return n("radius1","radius2","x","y","rotation").attachTo(e),r("Ellipsis","radius1","radius2","x","y","rotation").attachTo(e),i.attachTo(e),c.attachTo(e),a.attachTo(e),s.attachTo(e),e.prototype.center=function(){return new f(this.x,this.y)},e.prototype.left=function(){return Math.min.apply(Math,this.xBounds())},e.prototype.right=function(){return Math.max.apply(Math,this.xBounds())},e.prototype.bottom=function(){return Math.max.apply(Math,this.yBounds())},e.prototype.top=function(){return Math.min.apply(Math,this.yBounds())},e.prototype.xBounds=function(){var e,t,n=this;return e=Math.degToRad(this.rotation),t=Math.atan(-this.radius2*Math.tan(e)/this.radius1),[t,t+Math.PI].map(function(t){return n.x+n.radius1*Math.cos(t)*Math.cos(e)-n.radius2*Math.sin(t)*Math.sin(e)})},e.prototype.yBounds=function(){var e,t,n=this;return e=Math.degToRad(this.rotation),t=Math.atan(this.radius2*(Math.cos(e)/Math.sin(e))/this.radius1),[t,t+Math.PI].map(function(t){return n.y+n.radius1*Math.cos(t)*Math.sin(e)+n.radius2*Math.sin(t)*Math.cos(e)})},e.prototype.points=function(){var e,t,n,r;r=[];for(e=t=0,n=this.segments;0<=n?t<=n:t>=n;e=0<=n?++t:--t)r.push(this.pathPointAt(e/this.segments));return r},e.prototype.closedGeometry=function(){return!0},e.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(Math.degToRad(e))*1e4,Math.sin(Math.degToRad(e))*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},e.prototype.acreage=function(){return Math.PI*this.radius1*this.radius2},e.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),r=this.pathPointAt(e.get()),t=this.center(),n=r.subtract(t),t.add(n.scale(Math.sqrt(e.random())))},e.prototype.contains=function(e,t){var n,r,i,s,o,u,a;return a=f.coordsFrom(e,t),u=a[0],t=a[1],s=new f(u,t),r=this.center(),i=s.subtract(r),n=i.angle(),o=this.pointAtAngle(n),r.distance(o)>=r.distance(s)},e.prototype.length=function(){return Math.PI*(3*(this.radius1+this.radius2)-Math.sqrt((3*this.radius1+this.radius2)*(this.radius1+this.radius2*3)))},e.prototype.pathPointAt=function(e){var t,n;return t=e*Math.PI*2,n=new f(Math.cos(t)*this.radius1,Math.sin(t)*this.radius2),this.center().add(n.rotate(this.rotation))},e.prototype.drawPath=function(e){return e.save(),e.translate(this.x,this.y),e.rotate(Math.degToRad(this.rotation)),e.scale(this.radius1,this.radius2),e.beginPath(),e.arc(0,0,1,0,Math.PI*2),e.closePath(),e.restore()},e.prototype.clone=function(){return new e(this)},e.prototype.ellipsisFrom=function(e,t,n,r,i,s){var o;return typeof e=="object"&&(o=e,e=o.radius1,t=o.radius2,n=o.x,r=o.y,i=o.rotation,s=o.segments),f.isFloat(e)||(e=1),f.isFloat(t)||(t=1),f.isFloat(n)||(n=0),f.isFloat(r)||(r=0),f.isFloat(i)||(i=0),f.isFloat(s)||(s=36),[e,t,n,r,i,s]},e}(),this.geomjs.Mixin=u,this.geomjs.Equatable=n,this.geomjs.Formattable=r,this.geomjs.Geometry=i,this.geomjs.Surface=c,this.geomjs.Path=a,this.geomjs.Intersections=s,this.geomjs.Point=f,this.geomjs.Matrix=o,this.geomjs.Rectangle=l,this.geomjs.Triangle=h,this.geomjs.Circle=e,this.geomjs.Ellipsis=t}).call(this)